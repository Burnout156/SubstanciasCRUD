<div class="page-bg"></div>
<div class="container">
  <!-- Cabe칞alho -->
  <div class="header">
    <h1 id="page-title">Cadastro de Subst칙ncias</h1>
  </div>

  <div class="main-content">
    <!-- Card: Formul치rio -->
    <div class="form-card">
      <h2 id="form-title">Nova Subst칙ncia</h2>

      <form (ngSubmit)="salvar()" #form="ngForm" id="substanciaForm">
        <!-- Linha: C칩digo / Nome -->
        <div class="form-row">
          <div class="form-group">
            <label for="codigo">C칩digo *</label>
            <input
              id="codigo"
              name="codigo"
              type="text"
              required
              [(ngModel)]="novaSubstancia.codigo"
            />
          </div>

          <div class="form-group">
            <label for="nome">Nome *</label>
            <input
              id="nome"
              name="nome"
              type="text"
              required
              [(ngModel)]="novaSubstancia.nome"
            />
          </div>
        </div>

        <!-- Categoria -->
        <div class="form-group">
          <label for="categoria">Categoria *</label>
          <select
            id="categoria"
            name="categoriaId"
            required
            [(ngModel)]="novaSubstancia.categoriaId"
          >
            <option [ngValue]="undefined" disabled>Selecione uma categoria</option>
            <option *ngFor="let c of categorias" [value]="c.id">
              {{ c.nome }}
            </option>
          </select>
        </div>

        <!-- Descri칞칚o -->
        <div class="form-group">
          <label for="descricao">Descri칞칚o</label>
          <textarea
            id="descricao"
            name="descricao"
            placeholder="Descreva as caracter칤sticas da subst칙ncia..."
            [(ngModel)]="novaSubstancia.descricao"
          ></textarea>
        </div>

        <!-- Notas -->
        <div class="form-group">
          <label for="notas">Notas</label>
          <textarea
            id="notas"
            name="notas"
            placeholder="Observa칞칫es adicionais..."
            [(ngModel)]="novaSubstancia.notas"
          ></textarea>
        </div>

        <!-- Propriedades -->
        <div class="properties-section">
          <h3>Propriedades</h3>

          <div class="properties-grid" id="propriedades">
            <label
              class="property-item"
              *ngFor="let p of propriedades"
              [attr.for]="'prop-'+p.id"
            >
              <input
                type="checkbox"
                class="prop-checkbox"
                [id]="'prop-'+p.id"
                [checked]="isChecked(p.id!)"
                (change)="togglePropriedade(p, $event)"
              />
              <div>
                <div class="property-label">{{ p.nome }}</div>
                <div class="property-type">
                  {{ p.valueType === 0 ? 'Boolean' : 'Decimal' }}
                </div>
              </div>
            </label>
          </div>
        </div>

        <!-- Bot칚o salvar -->
        <button
          id="salvarBtn"
          class="btn btn-primary"
          type="submit"
          [disabled]="form.invalid"
        >
          Salvar Subst칙ncia
        </button>
      </form>
    </div>

    <!-- Card: Tabela -->
    <div class="table-card">
      <h2 id="table-title">Subst칙ncias Cadastradas</h2>

      <!-- Empty state -->
      <div class="empty-state" *ngIf="!substancias || substancias.length === 0">
        <div class="empty-state-icon">游빍</div>
        <p>Nenhuma subst칙ncia cadastrada ainda.</p>
        <p>Use o formul치rio ao lado para adicionar a primeira subst칙ncia.</p>
      </div>

      <!-- Tabela -->
      <div class="table-container" *ngIf="substancias && substancias.length > 0">
        <table>
          <thead>
            <tr>
              <th>C칩digo</th>
              <th>Nome</th>
              <th>Categoria</th>
              <th style="width: 1%;">A칞칫es</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let s of substancias; trackBy: trackById">
              <td>{{ s.codigo }}</td>
              <td>{{ s.nome }}</td>
              <td>{{ getCategoriaNome(s.categoriaId, s.categoriaNome) }}</td>
              <td>
                <button class="btn btn-danger" type="button" (click)="deletar(s.id!)">
                  Excluir
                </button>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>
